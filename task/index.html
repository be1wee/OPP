<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Task Details</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="../modalManager/modal.js"></script>
    <style>
        .edit-mode {
            display: none;
        }
        
        .view-mode {
            display: block;
        }
        
        .editable-title {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .editable-description {
            position: relative;
        }
        
        .description-header {
            display: flex;
            gap: 1vw;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .description-actions {
            display: flex;
            gap: 10px;
        }
        
        .edit-description-btn {
            --size: 40px;
            background: transparent;
            border: none;
            border-radius: 10px;
            width: var(--size);
            height: var(--size);
            color: var(--text-secondary);
            padding: 6px 12px;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
        }
        
        .edit-description-btn:hover {
            transform: translateY(-2px);
        }
        .edit-description-btn>img{
            --size: 40px;
            width: var(--size);
            height: var(--size);
        }
        
        .title-input {
            background: transparent;
            border: 2px solid var(--primary);
            border-radius: 8px;
            padding: 8px 15px;
            font-size: 2rem;
            color: var(--text);
            width: 100%;
            font-weight: 700;
        }
        
        .description-content {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 20px;
            color: var(--text-secondary);
            min-height: 100px;
            line-height: 1.6;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        
        .description-input {
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid var(--border);
            border-radius: 8px;
            padding: 15px;
            color: var(--text-secondary);
            width: 100%;
            min-height: 200px;
            resize: vertical;
            font-size: 1rem;
            line-height: 1.6;
            font-family: inherit;
        }
        
        .description-input:focus {
            border-color: var(--primary);
            outline: none;
        }
        
        .save-btn {
            background: linear-gradient(45deg, var(--primary), var(--primary-dark));
            border: none;
            border-radius: 8px;
            color: white;
            padding: 8px 20px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .save-btn:hover {
            opacity: 0.9;
            transform: translateY(-2px);
        }
        
        .cancel-btn {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text);
            padding: 8px 20px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .cancel-btn:hover {
            background: rgba(255, 255, 255, 0.1);
        }
        
        .edit-icon {
            cursor: pointer;
            margin-left: 10px;
            opacity: 0.7;
            transition: opacity 0.3s ease;
        }
        
        .edit-icon:hover {
            opacity: 1;
        }
        
        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            justify-content: flex-end;
        }
        
        .empty-description {
            color: var(--text-secondary);
            font-style: italic;
            opacity: 0.7;
        }
    </style>
</head>

<body>
    <div class="liquid-bg"></div>
    <div class="animated-grid"></div>

    <a href="#" id="backBtn" class="back-btn">‚Üê Back</a>

    <header class="task-header">
        <div class="task-title-section">
            <div class="task-status-icon" id="taskStatusIcon">üìã</div>
            <div style="width: 100%;">
                <div class="editable-title">
                    <h1 id="taskTitle" class="view-mode">Loading...</h1>
                    <input type="text" id="taskTitleInput" class="edit-mode title-input" style="display: none;">
                    <span class="edit-icon" id="editTitleBtn" onclick="enableTitleEdit()">‚úèÔ∏è</span>
                </div>
                <div class="task-project" id="taskProject"></div>
            </div>
        </div>
        <div class="task-actions">
            <button class="action-btn danger" onclick="deleteTask()" id="deleteBtn">üóëÔ∏è Delete</button>
        </div>
    </header>

    <main class="task-main">
        <div class="task-content">
            <div class="task-details">
                <div class="details-section">
                    <h2>Task Details</h2>
                    <div class="details-grid">
                        <div class="detail-item">
                            <span class="detail-label">Status:</span>
                            <span class="detail-value" id="taskStatus"></span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Assignee:</span>
                            <span class="detail-value" id="taskAssignee"></span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Deadline:</span>
                            <span class="detail-value" id="taskDeadline"></span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Created:</span>
                            <span class="detail-value" id="taskCreated"></span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Last Updated:</span>
                            <span class="detail-value" id="taskUpdated"></span>
                        </div>
                    </div>
                </div>

                <div class="details-section">
                    <div class="description-header">
                        <h2 style="margin: 0;">Description</h2>
                        <div class="description-actions">
                            <button class="edit-description-btn" onclick="enableDescriptionEdit()" id="editDescriptionBtn">
                                <img src="../media/edit-white.svg" alt="">
                            </button>
                        </div>
                    </div>
                    
                    <div class="editable-description">
                        <div class="description-content view-mode" id="taskDescription">
                            <span class="empty-description"></span>
                        </div>
                        <div class="edit-mode" id="descriptionEditContainer" style="display: none;">
                            <textarea id="taskDescriptionInput" class="description-input" placeholder="Enter task description..."></textarea>
                            <div class="button-group">
                                <button class="cancel-btn" onclick="cancelDescriptionEdit()">Cancel</button>
                                <button class="save-btn" onclick="saveDescription()">Save Changes</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="task-sidebar">
                <div class="sidebar-section">
                    <h3>Quick Actions</h3>
                    <div class="sidebar-btns-container">
                        <button class="sidebar-btn" onclick="updateStatus()"><svg fill="#ffffff" viewBox="0 0 24 24" id="update" data-name="Flat Line" xmlns="http://www.w3.org/2000/svg" class="icon flat-line"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"><path id="primary" d="M4,12A8,8,0,0,1,18.93,8" style="fill: none; stroke: #ffffff; stroke-linecap: round; stroke-linejoin: round; stroke-width: 2;"></path><path id="primary-2" data-name="primary" d="M20,12A8,8,0,0,1,5.07,16" style="fill: none; stroke: #ffffff; stroke-linecap: round; stroke-linejoin: round; stroke-width: 2;"></path><polyline id="primary-3" data-name="primary" points="14 8 19 8 19 3" style="fill: none; stroke: #ffffff; stroke-linecap: round; stroke-linejoin: round; stroke-width: 2;"></polyline><polyline id="primary-4" data-name="primary" points="10 16 5 16 5 21" style="fill: none; stroke: #ffffff; stroke-linecap: round; stroke-linejoin: round; stroke-width: 2;"></polyline></g></svg>Update status</button>
                        <button class="sidebar-btn" onclick="reassignTask()"><svg fill="#ffffff" viewBox="0 0 24 24" id="edit-user-left-4" data-name="Flat Color" xmlns="http://www.w3.org/2000/svg" class="icon flat-color"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"><path id="primary" d="M13,19.61a2,2,0,0,0-.59-1.41L7,12.81a5.94,5.94,0,0,1,1.65-.66,6,6,0,1,1,8.64,0A6,6,0,0,1,22,18a4,4,0,0,1-4,4H13Z" style="fill: #ffffff;"></path><path id="secondary" d="M5.09,12.29l6.62,6.61a1.05,1.05,0,0,1,.29.71V21a1,1,0,0,1-1,1H9.61a1,1,0,0,1-.71-.29L2.29,15.09a1,1,0,0,1,0-1.4l1.4-1.4A1,1,0,0,1,5.09,12.29Z" style="fill: #ba6c2c;"></path></g></svg>Reassign</button>
                        <button class="sidebar-btn" onclick="changeDeadline()"><svg version="1.0" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 64 64" enable-background="new 0 0 64 64" xml:space="preserve" fill="#ffffff"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <g> <path fill="#ffffff" d="M11,54h6c0.553,0,1-0.447,1-1v-5c0-0.553-0.447-1-1-1h-6c-0.553,0-1,0.447-1,1v5C10,53.553,10.447,54,11,54 z M12,49h4v3h-4V49z"></path> <path fill="#ffffff" d="M23,54h6c0.553,0,1-0.447,1-1v-5c0-0.553-0.447-1-1-1h-6c-0.553,0-1,0.447-1,1v5C22,53.553,22.447,54,23,54 z M24,49h4v3h-4V49z"></path> <path fill="#ffffff" d="M35,54h6c0.553,0,1-0.447,1-1v-5c0-0.553-0.447-1-1-1h-6c-0.553,0-1,0.447-1,1v5C34,53.553,34.447,54,35,54 z M36,49h4v3h-4V49z"></path> <path fill="#ffffff" d="M11,43h6c0.553,0,1-0.447,1-1v-5c0-0.553-0.447-1-1-1h-6c-0.553,0-1,0.447-1,1v5C10,42.553,10.447,43,11,43 z M12,38h4v3h-4V38z"></path> <path fill="#ffffff" d="M23,43h6c0.553,0,1-0.447,1-1v-5c0-0.553-0.447-1-1-1h-6c-0.553,0-1,0.447-1,1v5C22,42.553,22.447,43,23,43 z M24,38h4v3h-4V38z"></path> <path fill="#ffffff" d="M35,43h6c0.553,0,1-0.447,1-1v-5c0-0.553-0.447-1-1-1h-6c-0.553,0-1,0.447-1,1v5C34,42.553,34.447,43,35,43 z M36,38h4v3h-4V38z"></path> <path fill="#ffffff" d="M47,43h6c0.553,0,1-0.447,1-1v-5c0-0.553-0.447-1-1-1h-6c-0.553,0-1,0.447-1,1v5C46,42.553,46.447,43,47,43 z M48,38h4v3h-4V38z"></path> <path fill="#ffffff" d="M11,32h6c0.553,0,1-0.447,1-1v-5c0-0.553-0.447-1-1-1h-6c-0.553,0-1,0.447-1,1v5C10,31.553,10.447,32,11,32 z M12,27h4v3h-4V27z"></path> <path fill="#ffffff" d="M23,32h6c0.553,0,1-0.447,1-1v-5c0-0.553-0.447-1-1-1h-6c-0.553,0-1,0.447-1,1v5C22,31.553,22.447,32,23,32 z M24,27h4v3h-4V27z"></path> <path fill="#ffffff" d="M35,32h6c0.553,0,1-0.447,1-1v-5c0-0.553-0.447-1-1-1h-6c-0.553,0-1,0.447-1,1v5C34,31.553,34.447,32,35,32 z M36,27h4v3h-4V27z"></path> <path fill="#ffffff" d="M47,32h6c0.553,0,1-0.447,1-1v-5c0-0.553-0.447-1-1-1h-6c-0.553,0-1,0.447-1,1v5C46,31.553,46.447,32,47,32 z M48,27h4v3h-4V27z"></path> <path fill="#ffffff" d="M60,4h-7V3c0-1.657-1.343-3-3-3s-3,1.343-3,3v1H17V3c0-1.657-1.343-3-3-3s-3,1.343-3,3v1H4 C1.789,4,0,5.789,0,8v52c0,2.211,1.789,4,4,4h56c2.211,0,4-1.789,4-4V8C64,5.789,62.211,4,60,4z M49,3c0-0.553,0.447-1,1-1 s1,0.447,1,1v3v4c0,0.553-0.447,1-1,1s-1-0.447-1-1V6V3z M13,3c0-0.553,0.447-1,1-1s1,0.447,1,1v3v4c0,0.553-0.447,1-1,1 s-1-0.447-1-1V6V3z M62,60c0,1.104-0.896,2-2,2H4c-1.104,0-2-0.896-2-2V17h60V60z M62,15H2V8c0-1.104,0.896-2,2-2h7v4 c0,1.657,1.343,3,3,3s3-1.343,3-3V6h30v4c0,1.657,1.343,3,3,3s3-1.343,3-3V6h7c1.104,0,2,0.896,2,2V15z"></path> </g> </g></svg>Change Deadline</button>
                    </div>
                </div>

                <div class="sidebar-section">
                    <h3>Task Info</h3>
                    <div class="info-item">
                        <span class="info-label">Task ID:</span>
                        <span class="info-value" id="taskId"></span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Parent Task:</span>
                        <span class="info-value" id="parentTask">None</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Project ID:</span>
                        <span class="info-value" id="projectId"></span>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script>
        const params = new URLSearchParams(window.location.search);
        const taskId = params.get("id");
        const projectId = params.get("project");
        let taskData = null;
        let originalTitle = '';
        let originalDescription = '';

        if (!taskId || !projectId) {
            Modal.show('Task ID or Project ID missing');
            window.location.href = "/";
        }

        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('backBtn').href = `/project/project.html?id=${projectId}`;
            loadTask();
            
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    if (document.getElementById('descriptionEditContainer').style.display !== 'none') {
                        cancelDescriptionEdit();
                    }
                    if (document.getElementById('taskTitleInput').style.display !== 'none') {
                        cancelTitleEdit();
                    }
                }
            });
        });

        async function loadTask() {
            try {
                const token = localStorage.getItem('auth_token');
                
                const response = await axios.get(`http://193.124.112.102/api/tasks/${taskId}`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                
                taskData = response.data.data;
                renderTask();
                
                if (taskData.parent_task_id) {
                    loadParentTask();
                }
                
            } catch (error) {
                console.error("Error loading task:", error);
                if (error.response?.status === 401) {
                    window.location.href = '/login/';
                } else if (error.response?.status === 404) {
                    // alert("Task not found");
                    Modal.show('Task not found');

                    window.location.href = `/project/project.html?id=${projectId}`;
                }
            }
        }

        function renderTask() {
            if (!taskData) return;
            
            document.getElementById('taskTitle').textContent = taskData.title;
            document.getElementById('taskTitleInput').value = taskData.title;
            document.getElementById('taskProject').textContent = `Project: ${projectId.substring(0, 8)}`;
            
            const description = taskData.description;
            const descriptionElement = document.getElementById('taskDescription');
            
            if (description && description.trim() !== '') {
                descriptionElement.innerHTML = description.replace(/\n/g, '<br>');
                descriptionElement.classList.remove('empty-description');
            } else {
                descriptionElement.innerHTML = '<span class="empty-description">No description provided. Click "Edit" to add one.</span>';
            }
            
            document.getElementById('taskDescriptionInput').value = taskData.description || '';
            document.getElementById('taskId').textContent = taskData.id.substring(0, 8);
            document.getElementById('projectId').textContent = projectId.substring(0, 8);
            
            originalTitle = taskData.title;
            originalDescription = taskData.description || '';
            
            updateStatusDisplay();
            updateAssigneeDisplay();
            updateDates();
        }

        function enableTitleEdit() {
            document.getElementById('taskTitle').style.display = 'none';
            document.getElementById('taskTitleInput').style.display = 'block';
            document.getElementById('taskTitleInput').focus();
            document.getElementById('taskTitleInput').select();
            document.getElementById('editTitleBtn').style.display = 'none';
            
            document.getElementById('taskTitleInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    saveTitle();
                }
            });
        }

        async function saveTitle() {
            const newTitle = document.getElementById('taskTitleInput').value.trim();
        
            if (newTitle === originalTitle) {
                cancelTitleEdit();
                return;
            }
            
            try {
                const token = localStorage.getItem('auth_token');
                
                const response = await axios.put(`http://193.124.112.102/api/tasks/${taskId}`, {
                    title: newTitle
                }, {
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });
                
                taskData.title = newTitle;
                originalTitle = newTitle;
                document.getElementById('taskTitle').textContent = newTitle;
                cancelTitleEdit();
                
                // alert("Title updated successfully!");
                Modal.show('Title updated successfully!');

                
            } catch (error) {
                console.error("Error updating title:", error);
                // alert("Failed to update title: " + (error.response?.data?.message || error.message));
                Modal.show('Failed to update title: ' + (error.response?.data?.message || error.message));
            }
        }

        function cancelTitleEdit() {
            document.getElementById('taskTitleInput').value = originalTitle;
            document.getElementById('taskTitle').style.display = 'block';
            document.getElementById('taskTitleInput').style.display = 'none';
            document.getElementById('editTitleBtn').style.display = 'inline';
        }

        function enableDescriptionEdit() {
            document.getElementById('taskDescription').style.display = 'none';
            document.getElementById('descriptionEditContainer').style.display = 'block';
            document.getElementById('editDescriptionBtn').style.display = 'none';
            document.getElementById('taskDescriptionInput').focus();
            document.getElementById('taskDescriptionInput').select();
        }

        async function saveDescription() {
            const newDescription = document.getElementById('taskDescriptionInput').value.trim();
            
            if (newDescription === originalDescription) {
                cancelDescriptionEdit();
                return;
            }
            
            try {
                const token = localStorage.getItem('auth_token');
                
                const response = await axios.put(`http://193.124.112.102/api/tasks/${taskId}`, {
                    description: newDescription || null
                }, {
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });
                
                taskData.description = newDescription || null;
                originalDescription = newDescription;
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –æ–ø–∏—Å–∞–Ω–∏—è
                const descriptionElement = document.getElementById('taskDescription');
                if (newDescription && newDescription.trim() !== '') {
                    descriptionElement.innerHTML = newDescription.replace(/\n/g, '<br>');
                    descriptionElement.classList.remove('empty-description');
                } else {
                    descriptionElement.innerHTML = '<span class="empty-description">No description provided. Click "Edit" to add one.</span>';
                }
                
                cancelDescriptionEdit();
                // alert("Description updated successfully!");
                Modal.show('Description updated successfully!');

                
            } catch (error) {
                console.error("Error updating description:", error);
                // alert("Failed to update description: " + (error.response?.data?.message || error.message));
                Modal.show('Failed to update description: ' + (error.response?.data?.message || error.message));

            }
        }

        function cancelDescriptionEdit() {
            document.getElementById('taskDescriptionInput').value = originalDescription;
            document.getElementById('taskDescription').style.display = 'block';
            document.getElementById('descriptionEditContainer').style.display = 'none';
            document.getElementById('editDescriptionBtn').style.display = 'flex';
        }

        async function loadParentTask() {
            try {
                if (!taskData.parent_task_id) return;
                
                const token = localStorage.getItem('auth_token');
                
                const response = await axios.get(`http://193.124.112.102/api/tasks/${taskData.parent_task_id}`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                
                const parentTask = response.data.data;
                document.getElementById('parentTask').textContent = parentTask.title;
                document.getElementById('parentTask').style.cursor = 'pointer';
                document.getElementById('parentTask').style.color = 'var(--primary)';
                document.getElementById('parentTask').style.textDecoration = 'underline';
                document.getElementById('parentTask').onclick = () => {
                    window.location.href = `/task/task.html?id=${parentTask.id}&project=${projectId}`;
                };
                
            } catch (error) {
                console.error("Error loading parent task:", error);
                document.getElementById('parentTask').textContent = 'Parent Task';
            }
        }

        function updateStatusDisplay() {
            const statusText = getStatusText(taskData.status);
            const statusIcon = getStatusIcon(taskData.status);
            
            document.getElementById('taskStatusIcon').textContent = statusIcon;
            document.getElementById('taskStatus').textContent = statusText;
            document.getElementById('taskStatus').className = `detail-value status-${taskData.status}`;
        }

        function updateAssigneeDisplay() {
            const assigneeEmail = taskData.owner?.email || 'Unassigned';
            const currentUserEmail = localStorage.getItem('userEmail');
            
            let displayText = assigneeEmail;
            if (assigneeEmail === currentUserEmail) {
                displayText = 'You';
            }
            
            document.getElementById('taskAssignee').textContent = displayText;
        }

        function updateDates() {
            const deadline = taskData.deadline ? new Date(taskData.deadline).toLocaleDateString() : 'No deadline';
            const created = new Date(taskData.created_at).toLocaleDateString();
            const updated = new Date(taskData.updated_at).toLocaleDateString();
            
            document.getElementById('taskDeadline').textContent = deadline;
            document.getElementById('taskCreated').textContent = created;
            document.getElementById('taskUpdated').textContent = updated;
        }

        function getStatusText(status) {
            switch(status) {
                case 0: return 'Waiting';
                case 1: return 'In Progress';
                case 2: return 'Completed';
                default: return 'Unknown';
            }
        }

        function getStatusIcon(status) {
            switch(status) {
                case 0: return 'üìã';
                case 1: return 'üîÑ';
                case 2: return '‚úÖ';
                default: return 'üìã';
            }
        }

        function editTask() {
            window.location.href = `/tasks/edit.html?id=${taskId}&project=${projectId}`;
        }

        async function deleteTask() {
            if (!confirm("Are you sure you want to delete this task? This action cannot be undone.")) {
                return;
            }
            
            try {
                const token = localStorage.getItem('auth_token');
                
                await axios.delete(`http://193.124.112.102/api/tasks/${taskId}`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                
                // alert("Task deleted successfully!");
                Modal.show('Task deleted successfully!');

                window.location.href = `/project/project.html?id=${projectId}`;
                
            } catch (error) {
                console.error("Error deleting task:", error);
                // alert("Failed to delete task: " + (error.response?.data?.message || error.message));
                Modal.show("Failed to delete task: " + (error.response?.data?.message || error.message));
            }
        }

        function createSubtask() {
            window.location.href = `/tasks/index.html?project=${projectId}&parent=${taskId}`;
        }

        function updateStatus() {
            const newStatus = prompt("Enter new status (0=Waiting, 1=In Progress, 2=Completed):", taskData.status);
            
            if (newStatus === null) return;
            
            const statusNum = parseInt(newStatus);
            if (isNaN(statusNum) || statusNum < 0 || statusNum > 2) {
                // alert("Invalid status. Please enter 0, 1, or 2.");
                Modal.show("Invalid status. Please enter 0, 1, or 2.");

                return;
            }
            
            updateTaskField('status', statusNum);
        }

        function reassignTask() {
            const newAssignee = prompt("Enter new assignee email (leave empty to unassign):");
            
            if (newAssignee === null) return;
            
            updateTaskField('owner_email', newAssignee || null);
        }

        function changeDeadline() {
            const currentDeadline = taskData.deadline ? new Date(taskData.deadline).toISOString().split('T')[0] : '';
            const newDeadline = prompt("Enter new deadline (YYYY-MM-DD):", currentDeadline);
            
            if (newDeadline === null) return;
            
            updateTaskField('deadline', newDeadline || null);
        }

        async function updateTaskField(field, value) {
            try {
                const token = localStorage.getItem('auth_token');
                
                const updateData = { [field]: value };
                
                const response = await axios.put(`http://193.124.112.102/api/tasks/${taskId}`, updateData, {
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });
                
                // alert("Task updated successfully!");
                Modal.show('Task updated successfully!');

                loadTask();
                
            } catch (error) {
                console.error("Error updating task:", error);
                // alert("Failed to update task: " + (error.response?.data?.message || error.message));
                Modal.show("Failed to update task: " + (error.response?.data?.message || error.message));
                
            }
        }
    </script>
</body>
</html>